<!DOCTYPE html>
<html>
    <head>
        <title>myhub</title>
        <link rel="stylesheet" type="text/css" href="kindle.css">
        
        <script type="text/javascript" src="/nowjs/now.js"></script>
        <script type="text/javascript">
            function getTwoDigitDate(number) 
            {
                return (('0' + number).slice(-2));
            }

            function prependEvent(time, input, text) 
            {
                var elContainer = document.createElement('div');
                elContainer.className = 'eventContainer';

                    var elTimeContainer = document.createElement('div');
                    elTimeContainer.className = 'eventContainerTime';
                    
                        var elTime = document.createElement('span');
                        elTime.className = 'eventTime'
                        elTime.innerHTML = time;                    
                    
                    elTimeContainer.appendChild(elTime);
                    
                    var elTextContainer = document.createElement('div');
                    elTextContainer.className = 'eventContainerText';                
                        
                        var elText = document.createElement('span');
                        elText.className = 'eventText'
                        elText.innerHTML = text;                        
                        
                    elTextContainer.appendChild(elText);

                elContainer.appendChild(elTimeContainer);
                elContainer.appendChild(elTextContainer);

                if (document.body.firstChild) document.body.insertBefore(elContainer, document.body.firstChild);
                else document.body.appendChild(elContainer);
            }

            function printEvent(event) 
            {
                var eventDate = new Date(event.date);

                var time = getTwoDigitDate(eventDate.getUTCHours() + 2) + ':' + getTwoDigitDate(eventDate.getUTCMinutes());

                prependEvent(time, event.input, event.text);
            }

            now.ready(function()
            {
                window.now = now;

                now.getData('latest.month', { type: 'message' }, function(data) 
                {
                    if (data && data.length > 0) 
                    {
                        data.reverse();
                        var length = data.length < 10 ? data.length : 10;
                        for (var idxEvent = (length - 1); idxEvent >= 0; idxEvent--) 
                        {
                            if (!data.hasOwnProperty(idxEvent))  { continue; }
                            printEvent(data[idxEvent]);
                        }
                    }

                    now.onNewEvent = function(type, data) 
                    {
                        if (type === 'event' && data) 
                        {
                            if (data.type && data.input) 
                            {
                                if (data.type === 'message') 
                                {
                                    printEvent(data);
                                }
                                else if (data.type === 'error') 
                                {
                                    printEvent({
                                        input: 'error',
                                        text: ('Error in module ' + data.input),
                                        date: Date.now()
                                    });
                                }
                            }
                        }
                    };
                });
            });
        </script>
    </head>
    
    <body class="listContainer"></body> 
</html>
